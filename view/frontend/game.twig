{% extends "front.twig" %}

{% block title %}
    <title>{{ game.getName }} | LISTaGAME</title>
{% endblock %}

{% set commentsOnPage = false %}

{% set cover = true %}

{% block cover %}
    <div class="background_game_image container-fluid" style="background-image: url('{{ HOST }}public/images/covers/cover_game_id_{{ game.getId }}.{{ game.getCover_extension }}')"></div>
{% endblock %}

{% block content %}

    <h1>{{ game.getName }}</h1>

    <p>Développeur(s) :<br>
        {% for developer in developers %} 
            <p>- {{ developer.getName }}</p>
        {% endfor %}
    </p>

    <p>Genre(s) :<br>
        {% for genre in genres %} 
            <p>- {{ genre.getName }}</p>
        {% endfor %}
    </p>

    <p>Mode(s) de jeu :<br>
        {% for mode in modes %} 
            <p>- {{ mode.getName }}</p>
        {% endfor %}
    </p>

    <p>Sorties :<br>
        {% for release in releases %} 
            <p>- Sur {{ release.getPlatform }}, édité par {{ release.getPublisher }} - {{ release.getRegion }} - {{  release. getReleaseDate }}</p>
        {% endfor %}
    </p>

    <p>{{ game.getContent|raw }}</p>

    {% if connected %}

        <hr>

        <h4 id="anchorGame" class="anchor">Ajouter un commentaire</h4>

        <form method="post" action="{{ HOST }}add-comment">

            <div class="form-group">
                <input type="hidden" name="game-id" value="{{ game.getId }}" />
            </div>

            <div class="form-group">
                <input type="hidden" name="member-id" value="{{ member.getId }}" />
            </div>

            <div class="form-group">
                <textarea class="form-control" id="content" name="content" rows="5"></textarea>
            </div>
        
            <input type="submit" value="Envoyer" class="btn btn-primary" />

        </form>

    {% endif %}

    <hr>

    <h4>Commentaires</h4>

    {% for comment in comments %}

        {% set commentsOnPage = true %}

        <div class="comment container">

            {% if comment.getMemberType == 1 or comment.getMemberType == 2 %}
                {% set backgroundComment = 'bg-dark text-light' %}
            {% else %}
                {% set backgroundComment = 'bg-secondary text-light' %}
            {% endif %}

            {% if comment.getReported == true %}
                {% set backgroundComment = 'bg-warning text-dark' %}
            {% endif %}

            <div class="row">
                
                <p class="col-12 authorCommentBloc {{ backgroundComment }}">
                    <span id="commentAuthor{{ comment.getMemberNickName }}" class="font-weight-bold">{{ comment.getMemberNickName }}</span> (publié le {{ comment.getCreationDate }}) - <span class="italic">{% if comment.getMemberType == 1 %}Administrateur{% elseif comment.getMemberType == 2 %}Modérateur{% else %}Membre{% endif %}</span>
                </p>
                <p class="col-12 textComment">{% if comment.getReported == true %}Commentaire signalé par la communauté.{% else %}{{ comment.getContent }}{% endif %}</p>
                <div class="col-12 commentButtonBloc d-flex justify-content-end">
        
                <a href="{{ HOST }}report-comment/id/{{ comment.getId }}/game-id/{{ game.getId }}">
                    <button type="button" class="btn btn-warning btn-sm">Signaler</button>
                </a>
        
                <!-- If admin or moderator, comments can be published or deleted -->
                {% if member.getId_type == 1 or member.getId_type == 2 %}

                    {% if comment.getReported == true %}
                        <a class="ml-2" href="{{ HOST }}valid-comment/id/{{ comment.getId }}/game-id/{{ game.getId }}">
                            <button type="button" class="btn btn-success btn-sm">Publier</button>
                        </a>
                    {% endif %}
        
                    <button type="button" class="btn btn-danger btn-sm ml-2" data-toggle="modal" data-target="#deleteModal" data-member-author="{{ comment.getMemberNickName }}" data-url-delete-comment="{{ HOST }}delete-comment/id/{{ comment.getId }}/game-id/{{ game.getId }}">Supprimer</button>

                {% endif %}

                </div>
            </div>
        </div>

    {% endfor %}

    {% if commentsOnPage and renderPagination %}
        {{ pagination.render }}
    {% elseif not commentsOnPage %}
        <p>Il n'y a actuellement aucun commentaire</p>
    {% endif %}

    {% if actionDone %}
        <div class="alert alert-success alert-dismissible fade show actionErrorMessage fixed-bottom" role="alert">
            {{ actionDone }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    {% endif %}

    {% if errorMessage %}
        <div class="alert alert-danger alert-dismissible fade show actionErrorMessage fixed-bottom" role="alert">
            {{ errorMessage }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    {% endif %}

{% endblock %}